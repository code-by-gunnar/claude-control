---
phase: 02-config-viewers-settings
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scanner/paths.ts
  - src/commands/memory.ts
  - src/formatters/table.ts
  - src/formatters/json.ts
  - src/formatters/index.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "`claude-ctl memory` lists all CLAUDE.md files with scope and file path"
    - "User can view content of any CLAUDE.md file via `claude-ctl memory --show <path>`"
    - "`claude-ctl memory --json` produces valid JSON with file list and metadata"
    - "User-level CLAUDE.md (~/.claude/CLAUDE.md) is discovered by the scanner"
  artifacts:
    - path: "src/commands/memory.ts"
      provides: "Memory command registration with list and --show modes"
      exports: ["memoryCommand"]
      min_lines: 30
    - path: "src/formatters/table.ts"
      provides: "formatMemoryTable function"
      contains: "formatMemoryTable"
    - path: "src/formatters/json.ts"
      provides: "formatMemoryJson function"
      contains: "formatMemoryJson"
  key_links:
    - from: "src/commands/memory.ts"
      to: "scan()"
      via: "calls scan() and filters for claude-md type files"
      pattern: "scan\\("
    - from: "src/commands/memory.ts"
      to: "formatters"
      via: "imports formatMemory from formatters/index.ts"
    - from: "src/index.ts"
      to: "src/commands/memory.ts"
      via: "registers memoryCommand on Commander program"
---

<objective>
Create the CLAUDE.md viewer command that lists all CLAUDE.md files with scope awareness and allows content preview.

Purpose: Users need to see what CLAUDE.md memory files exist across global and project levels, and be able to quickly view their contents without manually navigating to each location.
Output: Working `claude-ctl memory` command with list and preview modes, table and JSON formatters.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/scanner/paths.ts
@src/scanner/index.ts
@src/scanner/types.ts
@src/commands/scan.ts
@src/commands/status.ts
@src/formatters/index.ts
@src/formatters/table.ts
@src/formatters/json.ts
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add user-level CLAUDE.md to scanner + create memory command</name>
  <files>src/scanner/paths.ts, src/commands/memory.ts, src/index.ts</files>
  <action>
    1. In src/scanner/paths.ts, add user-level CLAUDE.md to the global (user-scope) paths section:
       - scope: "user", type: "claude-md", expectedPath: path.join(globalClaudeDir, "CLAUDE.md")
       - description: "User-level CLAUDE.md memory file"
       Place it after the keybindings entry, before the commands-dir entry.

    2. Create src/commands/memory.ts following the command-registration pattern (see scan.ts and status.ts):
       - Command: `claude-ctl memory [project-dir]`
       - Options:
         - `--show <path>`: Preview content of a specific CLAUDE.md file (full path or index number from list)
       - Action handler:
         a. Run scan(dir) to get all config files
         b. Filter for type === "claude-md" and exists === true
         c. If --show provided: find matching file by path (substring match) or by 1-based index number, display its content. If not found, show error with available files.
         d. If no --show: display file list using formatMemory(memoryFiles, json)
       - Use program.opts().json for JSON mode

    3. In src/index.ts, import and register memoryCommand following existing pattern:
       - import { memoryCommand } from "./commands/memory.js"
       - memoryCommand(program)
  </action>
  <verify>npm run build succeeds, npm run typecheck passes</verify>
  <done>Memory command registered, scanner discovers user-level CLAUDE.md, command filters and displays claude-md files</done>
</task>

<task type="auto">
  <name>Task 2: Create memory formatters (table + JSON)</name>
  <files>src/formatters/table.ts, src/formatters/json.ts, src/formatters/index.ts</files>
  <action>
    1. In src/formatters/table.ts, add formatMemoryTable function:
       - Input: ConfigFile[] (only claude-md files), projectDir: string | null
       - Output: formatted string
       - Display:
         - Header: "CLAUDE.md Memory Files" (chalk.bold)
         - If no files found: "No CLAUDE.md files found."
         - Table columns: Scope, Path, Size
         - Use shortenPath() for path display (existing function)
         - Show file size as human-readable (e.g., "1.2 KB")
         - Summary line: "N memory files found"
       - For --show mode, add formatMemoryContentTable function:
         - Input: ConfigFile (single file)
         - Output: file header (scope, path) then content with horizontal rule separators

    2. In src/formatters/json.ts, add formatMemoryJson function:
       - Input: ConfigFile[] (only claude-md files)
       - Output: JSON string with array of { path, scope, exists, sizeBytes, content }
       - For --show mode, add formatMemoryContentJson function:
         - Input: ConfigFile (single file)
         - Output: JSON string with { path, scope, content }

    3. In src/formatters/index.ts, add formatMemory and formatMemoryContent dispatch functions:
       - formatMemory(files: ConfigFile[], projectDir: string | null, json: boolean): string
       - formatMemoryContent(file: ConfigFile, json: boolean): string
       - Route to table or json formatter based on json flag
       - Add re-exports for new formatter functions
  </action>
  <verify>npm run build succeeds, npm run typecheck passes</verify>
  <done>Memory formatters produce human-readable table and valid JSON output for both list and content preview modes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] `npm run typecheck` passes
- [ ] `claude-ctl memory` lists CLAUDE.md files with scope and path
- [ ] `claude-ctl memory --json` produces valid JSON
- [ ] `claude-ctl memory --show <path>` displays file content
- [ ] User-level CLAUDE.md (~/.claude/CLAUDE.md) appears in scan results
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- memory command follows established command-registration and formatter-dispatch patterns
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/02-config-viewers-settings/02-02-SUMMARY.md`
</output>
