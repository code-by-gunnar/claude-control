---
phase: 05-advanced-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/health/types.ts
  - src/health/resolver.ts
  - src/commands/health.ts
  - src/formatters/health.ts
  - src/formatters/index.ts
  - src/server/routes.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "User can see an overall health/completeness score for their Claude Code setup"
    - "User can see which recommended config files exist and which are missing"
    - "User can see specific recommendations for improving their config"
    - "Score is based on objective criteria (file existence, settings configured, etc.)"
  artifacts:
    - path: "src/health/types.ts"
      provides: "HealthCheck, HealthCategory, HealthResult types"
      min_lines: 20
    - path: "src/health/resolver.ts"
      provides: "Health scoring algorithm with categories and recommendations"
      min_lines: 80
  key_links:
    - from: "src/health/resolver.ts"
      to: "src/scanner/types.ts"
      via: "Uses ScanResult to compute score"
      pattern: "ScanResult"
    - from: "src/server/routes.ts"
      to: "src/health/resolver.ts"
      via: "GET /api/health endpoint"
      pattern: "api/health"
---

<objective>
Build config health/completeness scoring engine that evaluates a project's Claude Code setup against recommended practices and produces an actionable score with recommendations.

Purpose: Users want a quick "how well is my project configured?" assessment without manually checking each config file. This completes CONF-05.
Output: New `src/health/` module with scoring engine, new `health` CLI command, new API endpoint.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/scanner/types.ts
@src/scanner/index.ts
@src/server/routes.ts
@src/index.ts
@src/formatters/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create health scoring types and resolver</name>
  <files>src/health/types.ts, src/health/resolver.ts</files>
  <action>
    1. Create `src/health/types.ts`:
       ```typescript
       interface HealthCheck {
         id: string;              // e.g., "has-claude-md"
         label: string;           // "Project CLAUDE.md"
         category: string;        // "memory", "settings", "mcp", "hooks", "permissions"
         passed: boolean;
         weight: number;          // 1-3 (importance)
         recommendation?: string; // shown when !passed
       }

       interface HealthCategory {
         name: string;
         score: number;           // 0-100
         maxScore: number;
         checks: HealthCheck[];
       }

       interface HealthResult {
         overallScore: number;    // 0-100
         grade: string;           // A, B, C, D, F
         categories: HealthCategory[];
         recommendations: string[];  // top actionable items
         summary: string;         // e.g., "Good setup, consider adding hooks"
       }
       ```

    2. Create `src/health/resolver.ts`:
       - Export `computeHealth(scanResult: ScanResult): HealthResult`
       - Takes a ScanResult (from scan()) and evaluates checks across categories:

       **Memory category (weight: high):**
       - Has project-level CLAUDE.md (weight 3) — most impactful for project use
       - Has user-level CLAUDE.md (weight 1) — nice to have for global context

       **Settings category (weight: medium):**
       - Has project settings.json (weight 2) — project-specific configuration
       - Has user settings.json (weight 1) — global preferences set

       **MCP category (weight: medium):**
       - Has at least one MCP server configured (weight 2) — extends capabilities
       - Has project-level .mcp.json (weight 1) — project-specific servers

       **Hooks category (weight: low):**
       - Has at least one hook configured (weight 1) — automation setup
       - Has custom commands directory (weight 1) — slash commands defined

       **Permissions category (weight: low):**
       - Has permissions configured (weight 1) — security awareness

       **Scoring algorithm:**
       - Each check: if passed, add weight to category score
       - Category score = (sum of passed weights / sum of all weights) * 100
       - Overall score = weighted average across categories:
         - Memory: 30%, Settings: 25%, MCP: 20%, Hooks: 15%, Permissions: 10%
       - Grade: A (90+), B (75-89), C (60-74), D (40-59), F (<40)

       **Recommendations:**
       - Collect all failed checks sorted by weight (highest first)
       - Generate actionable recommendation strings: "Create a CLAUDE.md in your project root to give Claude project-specific context"
       - Summary: 1-sentence based on grade

    Design notes:
    - Health checks work from ScanResult data — no additional file reads needed
    - The scoring is opinionated but reasonable — a project with CLAUDE.md + settings + MCP servers = good setup
    - Weights reflect real impact: CLAUDE.md is the most impactful config for daily Claude use
    - Use the scan result's `files` array: check existence, type, scope
    - For "has at least one MCP server": check if any mcp-type file exists with content
    - For "has hooks configured": check if any settings file has hooks key with entries
  </action>
  <verify>
    `npm run build` succeeds.
    Types are importable from `src/health/types.ts`.
    `computeHealth` is exported from `src/health/resolver.ts`.
  </verify>
  <done>
    Health scoring engine computes score from scan results with categories, checks, and recommendations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire health to CLI command and API</name>
  <files>src/commands/health.ts, src/formatters/health.ts, src/formatters/index.ts, src/server/routes.ts, src/index.ts</files>
  <action>
    1. Create `src/commands/health.ts`:
       - Register `health [project-dir]` command
       - Calls scan() then computeHealth()
       - Formats output with formatHealth()

    2. Create `src/formatters/health.ts`:
       - `formatHealth(result: HealthResult, projectDir: string, json: boolean): string`
       - Table format:
         - Big score display: "Health Score: 72/100 (C)"
         - Category breakdown: each category name, score bar (█░░), pass/fail counts
         - Recommendations section: numbered list of actionable items
       - JSON format: pass through HealthResult

    3. Update `src/formatters/index.ts`:
       - Export `formatHealth`

    4. Add API endpoint in `src/server/routes.ts`:
       - `GET /api/health` — calls scan + computeHealth, returns JSON

    5. Update `src/index.ts`:
       - Import and register `healthCommand`

    Design notes:
    - Score bar in terminal: use chalk to color the bar (green for 80+, yellow for 50-79, red for <50)
    - Keep recommendations concise and actionable ("Create CLAUDE.md" not "Consider setting up...")
    - Follow existing command pattern exactly: scan → resolve → format → stdout.write
  </action>
  <verify>
    `npm run build` succeeds.
    `node dist/index.js health` runs and shows score with recommendations.
    `node dist/index.js health --json` produces valid JSON with score, grade, categories.
    API `/api/health` returns JSON health result.
  </verify>
  <done>
    CLI `health` command shows completeness score with recommendations.
    API `/api/health` returns health data for dashboard.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] `src/health/types.ts` and `src/health/resolver.ts` exist with real implementation
- [ ] `node dist/index.js health` produces score output
- [ ] Score reflects actual config state (not hardcoded)
- [ ] Recommendations are actionable and relevant
- [ ] API `/api/health` returns valid JSON
</verification>

<success_criteria>
- All tasks completed
- Health score accurately reflects project configuration completeness
- Recommendations are specific and actionable
- Both CLI and API work
</success_criteria>

<output>
After completion, create `.planning/phases/05-advanced-features/05-02-SUMMARY.md`
</output>
