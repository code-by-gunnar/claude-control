---
phase: 07-dashboard-type-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/src/lib/api.ts
  - dashboard/src/pages/McpPage.tsx
  - dashboard/src/pages/HooksPage.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "MCP page expanded view shows server source path (not empty/undefined)"
    - "MCP page duplicate warnings render without crashing (dup.locations renders scope+path)"
    - "Hooks page expanded view shows hook matchers with patterns and commands"
    - "Commands section shows all .md command files; Skills section shows all group:name entries"
    - "React keys in McpPage use sourcePath (no undefined in key)"
  artifacts:
    - path: "dashboard/src/lib/api.ts"
      provides: "Dashboard type definitions matching server response shapes"
      contains: "sourcePath"
    - path: "dashboard/src/pages/McpPage.tsx"
      provides: "MCP server list with working drill-down and duplicate warnings"
      contains: "sourcePath"
    - path: "dashboard/src/pages/HooksPage.tsx"
      provides: "Hooks page with correct matchers structure and command/skill split by name"
      contains: "matchers"
  key_links:
    - from: "dashboard/src/lib/api.ts"
      to: "src/mcp/types.ts"
      via: "McpServer interface fields must match"
      pattern: "sourcePath.*string"
    - from: "dashboard/src/lib/api.ts"
      to: "src/hooks/types.ts"
      via: "HookEvent interface fields must match"
      pattern: "matchers.*HookMatcher"
---

<objective>
Fix 4 type mismatches in dashboard/src/lib/api.ts where dashboard interfaces diverged from actual server response shapes, causing MCP, Hooks, and Commands pages to render incorrectly.

Purpose: Close all integration and flow gaps from v1 milestone audit so WEB-03 (drill-down) is fully satisfied.
Output: Updated api.ts types + fixed McpPage.tsx and HooksPage.tsx components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/v1-MILESTONE-AUDIT.md

# Server-side types (the source of truth):
@src/mcp/types.ts
@src/hooks/types.ts

# Dashboard files to fix:
@dashboard/src/lib/api.ts
@dashboard/src/pages/McpPage.tsx
@dashboard/src/pages/HooksPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Align api.ts types with server response shapes</name>
  <files>dashboard/src/lib/api.ts</files>
  <action>
Fix 4 type mismatches in api.ts to match the actual server types:

1. **McpServer interface** (line 49-59):
   - Rename `source: string` to `sourcePath: string` to match `src/mcp/types.ts` line 12

2. **McpResult.duplicates** (line 62-64):
   - Change `duplicates: Array<{ name: string; sources: string[] }>` to
     `duplicates: Array<{ name: string; locations: Array<{ scope: string; sourcePath: string }> }>`
   - This matches `McpDuplicate` in `src/mcp/types.ts` lines 30-35

3. **HookEntry interface** (line 66-75):
   - Rename this to `HookEvent` to match server naming
   - Change `source: string` to `sourcePath: string`
   - Change `hooks: Array<{type: string; command?: string; pattern?: string}>` to
     `matchers: Array<{ matcher?: string; hooks: Array<{ type: string; command: string; async?: boolean }> }>`
   - This matches `HookEvent` and `HookMatcher` in `src/hooks/types.ts` lines 18-38
   - Keep `HookEntry` as an alias or separate type for the inner hook object if needed by page imports

4. **CommandEntry interface** (line 84-90):
   - Remove `source: string` (not in server type)
   - Remove `type: string` (not in server type — command vs skill is determined by name containing `:`)
   - Server's CommandEntry has only: `name`, `path`, `scope`
   - This matches `CommandEntry` in `src/hooks/types.ts` lines 43-50

Do NOT change the fetch functions — they are correct. Only fix the interface definitions.
  </action>
  <verify>cd dashboard && npx tsc --noEmit (TypeScript compilation should show errors in page files that reference old field names — expected, will fix in Task 2)</verify>
  <done>All 4 interfaces in api.ts match their server-side counterparts exactly</done>
</task>

<task type="auto">
  <name>Task 2: Fix McpPage.tsx and HooksPage.tsx to use corrected types</name>
  <files>dashboard/src/pages/McpPage.tsx, dashboard/src/pages/HooksPage.tsx</files>
  <action>
**McpPage.tsx fixes:**

1. Line 178: Change `server.source` to `server.sourcePath` in the Source detail row
2. Line 291: Change `server.source` to `server.sourcePath` in the React key (`${server.name}-${server.scope}-${server.sourcePath}`)
3. Lines 58-63 (DuplicateWarning): Change `dup.sources.join(", ")` to render `dup.locations` instead:
   ```
   {dup.locations.map(loc => `${loc.scope}: ${loc.sourcePath}`).join(", ")}
   ```
   Or render each location as a sub-item showing scope and path.

**HooksPage.tsx fixes:**

1. Update imports: Change `HookEntry` to `HookEvent` (or whatever the renamed type is called in api.ts). May need to also import the inner hook/matcher types.

2. Lines 55-61: `EventRow` component receives `entries: HookEvent[]` (was `HookEntry[]`). Update the type.

3. Lines 98-140: The expanded view renders `entry.source` and `entry.hooks`. Fix to:
   - Line 100 key: `entry.sourcePath` instead of `entry.source`
   - Line 107-109: `entry.sourcePath` instead of `entry.source` (title and display)
   - Lines 113-133: Instead of iterating flat `entry.hooks`, iterate `entry.matchers`. For each matcher, show `matcher.matcher` (the pattern), then iterate `matcher.hooks` for commands. Structure:
     ```
     for each matcher in entry.matchers:
       show matcher.matcher (pattern) if present
       for each hook in matcher.hooks:
         show hook.command
     ```

4. Lines 225-228: `eventEntries` type should use `HookEvent[]` instead of `HookEntry[]`

5. Lines 165-181 (CommandRow): Remove `CommandTypeBadge` usage since `command.type` no longer exists.
   Instead, determine type from name: if `command.name.includes(":")` it's a skill, otherwise a command.

6. Lines 314-377 (Commands and Skills sections): Replace `c.type === "command"` filter with `!c.name.includes(":")` and `c.type === "skill"` filter with `c.name.includes(":")`. This correctly distinguishes commands (flat .md files) from skills (group:name format).

7. Lines 148-163 (CommandTypeBadge): Keep the component but pass the derived type string instead of `command.type`. Derive it inline: `command.name.includes(":") ? "skill" : "command"`.

Do NOT change the data fetching logic, loading states, or error handling. Only fix field references and type annotations.
  </action>
  <verify>
1. `npm run build` succeeds (both tsup + Vite)
2. `npx tsc --noEmit` in dashboard/ passes with zero errors
3. Start dashboard with `node dist/index.js dashboard` and visually confirm:
   - MCP page: expand a server → source path is shown
   - Hooks page: expand a configured event → matchers and commands render
   - Hooks page: Commands section shows non-skill commands, Skills section shows group:name entries
  </verify>
  <done>
- McpPage drill-down shows sourcePath and duplicate warnings render locations with scope
- HooksPage drill-down shows matchers with patterns and commands
- Commands/Skills split works via name.includes(":") detection
- npm run build succeeds with zero errors
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds (tsup + Vite, no errors)
- [ ] `npm run typecheck` passes (tsc --noEmit, zero errors)
- [ ] `npm test` passes (existing 45 tests still green)
- [ ] Dashboard MCP page shows server details with sourcePath when expanded
- [ ] Dashboard MCP duplicate warnings render locations correctly (not crash)
- [ ] Dashboard Hooks page shows matchers/patterns/commands when event is expanded
- [ ] Dashboard Commands section populated (non-skill entries)
- [ ] Dashboard Skills section populated (group:name entries)
</verification>

<success_criteria>

- All 4 type mismatches in api.ts are fixed
- McpPage.tsx uses sourcePath and locations (not source/sources)
- HooksPage.tsx uses matchers structure (not flat hooks array)
- HooksPage.tsx uses name-based command/skill detection (not type field)
- Build and typecheck pass with zero errors
- Existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-dashboard-type-fixes/07-01-SUMMARY.md`
</output>
