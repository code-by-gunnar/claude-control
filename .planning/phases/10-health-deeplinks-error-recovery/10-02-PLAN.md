---
phase: 10-health-deeplinks-error-recovery
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - dashboard/src/components/ErrorState.tsx
  - dashboard/src/pages/OverviewPage.tsx
  - dashboard/src/pages/HealthPage.tsx
  - dashboard/src/pages/SettingsPage.tsx
  - dashboard/src/pages/MemoryPage.tsx
  - dashboard/src/pages/PermissionsPage.tsx
  - dashboard/src/pages/McpPage.tsx
  - dashboard/src/pages/PluginsPage.tsx
  - dashboard/src/pages/MarketplacesPage.tsx
  - dashboard/src/pages/HooksPage.tsx
  - dashboard/src/pages/AgentsPage.tsx
  - dashboard/src/pages/SkillsPage.tsx
autonomous: true

must_haves:
  truths:
    - "Every dashboard page shows a retry button when data fails to load"
    - "Clicking retry re-fetches only the current page's data without full page reload"
    - "Retry shows loading state while re-fetching"
  artifacts:
    - path: "dashboard/src/components/ErrorState.tsx"
      provides: "Reusable error state component with retry button"
      exports: ["ErrorState"]
      min_lines: 20
  key_links:
    - from: "ErrorState.tsx"
      to: "RefreshContext"
      via: "onRetry callback calls triggerRefresh()"
      pattern: "onRetry|triggerRefresh"
    - from: "All page components"
      to: "ErrorState"
      via: "import and render in error conditional"
      pattern: "<ErrorState"
---

<objective>
Add retry buttons to all dashboard error states using a reusable ErrorState component.

Purpose: Satisfies WORK-03 (error retry button) and WORK-04 (page-specific re-fetch). Currently errors show bare text with no recovery action. The retry leverages the existing RefreshContext — since only one page is mounted at a time with React Router, triggering refresh effectively re-fetches only the current page's data.
Output: ErrorState component + all 11 pages updated to use it.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-health-deeplinks-error-recovery/10-01-SUMMARY.md

@dashboard/src/components/EmptyState.tsx
@dashboard/src/lib/refresh-context.tsx
@dashboard/src/pages/HealthPage.tsx
@dashboard/src/pages/SettingsPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable ErrorState component</name>
  <files>dashboard/src/components/ErrorState.tsx</files>
  <action>
    Create `dashboard/src/components/ErrorState.tsx` — a reusable error display with retry button. Follow the same pattern as EmptyState.tsx for consistency.

    Props interface:
    ```typescript
    interface ErrorStateProps {
      title: string;       // e.g., "Error loading settings"
      message: string;     // The error message string
      onRetry: () => void; // Callback to retry the failed operation
    }
    ```

    Component structure:
    - Red-tinted container (bg-red-50 border border-red-200 rounded-lg p-6)
    - Exclamation triangle SVG icon (Heroicons outline, red-400, w-10 h-10)
    - Title in font-medium text-red-800
    - Error message in text-sm text-red-600
    - "Try Again" button styled as: px-4 py-2, bg-red-100 hover:bg-red-200, text-red-700, rounded-md, text-sm font-medium, with a refresh/arrow-path icon
    - Center-aligned layout similar to EmptyState

    Do NOT use window.location.reload() — the onRetry prop lets each page control retry behavior.
  </action>
  <verify>npm run build succeeds; component exports ErrorState</verify>
  <done>ErrorState component exists with title, message, and onRetry props. Styled consistently with existing design system.</done>
</task>

<task type="auto">
  <name>Task 2: Replace error blocks across all 11 dashboard pages</name>
  <files>
    dashboard/src/pages/OverviewPage.tsx,
    dashboard/src/pages/HealthPage.tsx,
    dashboard/src/pages/SettingsPage.tsx,
    dashboard/src/pages/MemoryPage.tsx,
    dashboard/src/pages/PermissionsPage.tsx,
    dashboard/src/pages/McpPage.tsx,
    dashboard/src/pages/PluginsPage.tsx,
    dashboard/src/pages/MarketplacesPage.tsx,
    dashboard/src/pages/HooksPage.tsx,
    dashboard/src/pages/AgentsPage.tsx,
    dashboard/src/pages/SkillsPage.tsx
  </files>
  <action>
    In each page, replace the inline error block with the ErrorState component.

    Each page currently has this pattern:
    ```tsx
    if (error) {
      return (
        <div>
          <h1 className="...">Page Title</h1>
          <div className="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
            <p className="font-medium">Error loading X</p>
            <p className="text-sm mt-1">{error}</p>
          </div>
        </div>
      );
    }
    ```

    Replace with:
    ```tsx
    if (error) {
      return (
        <div>
          <h1 className="...">Page Title</h1>
          <ErrorState
            title="Error loading X"
            message={error}
            onRetry={() => triggerRefresh()}
          />
        </div>
      );
    }
    ```

    For each page:
    1. Add import: `import { ErrorState } from "../components/ErrorState";`
    2. Destructure `triggerRefresh` from `useRefresh()` (most pages already have `const { refreshKey, setRefreshing } = useRefresh();` — add `triggerRefresh` to the destructure)
    3. Replace the error block with ErrorState component
    4. Keep the page title h1 above ErrorState (preserves page identity)

    Special case — HooksPage.tsx (line ~266-272): Already has a retry button using `window.location.reload()`. Replace the entire error block including that button with ErrorState + triggerRefresh.

    Pages to update (all 11):
    - OverviewPage: "Error loading dashboard data"
    - HealthPage: "Error loading health data"
    - SettingsPage: "Error loading settings"
    - MemoryPage: "Error loading memory files"
    - PermissionsPage: "Error loading permissions"
    - McpPage: "Error loading MCP data"
    - PluginsPage: "Error loading plugins"
    - MarketplacesPage: "Error loading marketplaces"
    - HooksPage: "Error loading hooks data"
    - AgentsPage: "Error loading agents"
    - SkillsPage: "Error loading commands data"
  </action>
  <verify>npm run build succeeds; grep -r "ErrorState" dashboard/src/pages/ shows all 11 pages; grep -r "window.location.reload" dashboard/src/pages/ shows 0 results</verify>
  <done>All 11 dashboard pages use ErrorState component with triggerRefresh retry. No pages use window.location.reload(). Retry button re-fetches only the current page's data.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests
- [ ] ErrorState component exists at dashboard/src/components/ErrorState.tsx
- [ ] All 11 pages import and use ErrorState
- [ ] All 11 pages wire onRetry to triggerRefresh()
- [ ] No pages use window.location.reload() for retry
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Every dashboard page shows retry button on error
- Retry re-fetches only current page data (via RefreshContext, not full reload)
- Consistent error styling across all pages
  </success_criteria>

<output>
After completion, create `.planning/phases/10-health-deeplinks-error-recovery/10-02-SUMMARY.md`
</output>
